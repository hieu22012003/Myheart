const _0x3d2e67=_0x48ee;!function(e,t){const o=_0x48ee,a=_0x7cf8();for(;;)try{if(936620===parseInt(o(321))/1+-parseInt(o(364))/2*(parseInt(o(331))/3)+parseInt(o(316))/4+-parseInt(o(340))/5*(-parseInt(o(362))/6)+-parseInt(o(569))/7*(-parseInt(o(534))/8)+parseInt(o(469))/9*(-parseInt(o(571))/10)+parseInt(o(312))/11)break;a.push(a.shift())}catch(e){a.push(a.shift())}}();import*as _0x87c664 from"three";import{OrbitControls}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/RenderPass.js";import{AfterimagePass}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/AfterimagePass.js";import{makeMat}from"./mins.js";!window[_0x3d2e67(539)]&&(window.Heartlove={data:{messages:["Anh yêu em",_0x3d2e67(390)],images:[],heartColor:_0x3d2e67(351)}}),function(){const e=_0x3d2e67,t=new URLSearchParams(window.location.search)[e(527)]("data");if(t)try{const o=decodeURIComponent(escape(atob(t))),a=JSON[e(574)](o);if(window[e(539)]={data:{messages:a[e(318)]||[],images:a[e(333)]||[],heartColor:a[e(389)]||e(351),music:a[e(369)]||null}},console[e(496)]("Heartlove data đã được load:",window[e(539)]),window.Heartlove[e(460)].music){const t=new Audio(window.Heartlove[e(460)][e(369)]);t[e(510)]=!0;const o=document[e(433)](e(474));o.id=e(545),o[e(523)]='<i class="fas fa-volume-high"></i>',document[e(345)][e(385)](o);let a=!1;const s=()=>{const t=e;o.innerHTML='<i class="fas '+(a?"fa-volume-high":t(457))+t(305)},n=()=>{const o=e;t[o(537)]().then((()=>{a=!0,s()}))[o(388)]((()=>{const e=o;console[e(496)](e(446))}))},r=()=>{t[e(536)](),a=!1,s()};o[e(475)]("click",(()=>{a?r():n()})),t[e(537)]()[e(529)]((()=>{a=!0,s()}))[e(388)]((()=>{const t=e,o=()=>{const e=_0x48ee;n(),document.removeEventListener(e(361),o)};document[t(475)](t(361),o)}))}}catch(t){console.error(e(393),t),window.Heartlove=null}else console.warn(e(558))}();const appData=window.Heartlove.data;let allWordsFlat=[];const originalTexts=appData[_0x3d2e67(318)]||[];originalTexts[_0x3d2e67(311)]((e=>{const t=_0x3d2e67,o=e[t(498)](" ");allWordsFlat[t(408)](...o)}));let currentWordIndex=0,nextWordSpawnTime=0;const WORD_SPAWN_INTERVAL=.4,IMAGE_CONFIG={paths:appData[_0x3d2e67(333)]||[],count:appData[_0x3d2e67(333)]?.[_0x3d2e67(392)]||0,scale:2.5,glowIntensity:.4,spawnRate:.18,maxActiveImages:45,spawnInterval:400};console[_0x3d2e67(496)](_0x3d2e67(405),IMAGE_CONFIG);const useCustomColor=appData.heartColor&&/^#([A-Fa-f0-9]{8}|[A-Fa-f0-9]{6})$/[_0x3d2e67(338)](appData.heartColor),heartInitialColor=new(_0x87c664[_0x3d2e67(306)])(useCustomColor?appData[_0x3d2e67(389)]:"#ff69b4");let imageTextures=[],imageLoadingComplete=!1,imagePool=[],activeImages=new Map,freeImageIndices=[],currentImageIndex=0,lastImageSpawnTime=0,imageSpawnQueue=[],minActiveImages=8,maxConcurrentImages=24,lastStatusLogTime=0,independentImageSprites=[],nextIndependentSpawnTime=0;const textureLoader=new _0x87c664.TextureLoader;async function fetchAndPrepareImageTextures(){const e=_0x3d2e67;try{const t=IMAGE_CONFIG[e(377)][e(371)]((t=>new Promise(((o,a)=>{const s=e;textureLoader[s(344)](t,(e=>{const t=s;e[t(563)]=_0x87c664.LinearFilter,e[t(562)]=_0x87c664[t(373)],e[t(557)]=_0x87c664[t(468)],e[t(426)]=!0,o(e)}),void 0,(e=>{const t=s,a=document[t(433)](t(553));a.width=a[t(556)]=512;const n=a[t(509)]("2d"),r=n[t(438)](256,256,0,256,256,256);r[t(476)](0,t(564)),r[t(476)](1,"#ff149300"),n[t(322)]=r,n[t(473)](0,0,512,512);const i=new(_0x87c664[t(325)])(a);i.needsUpdate=!0,o(i)}))}))));return imageTextures=await Promise.all(t),!0}catch(e){return!1}}function buildImageSpriteMaterial(e,t=1){return new(_0x87c664[_0x3d2e67(442)])({map:e,transparent:!0,opacity:t,depthWrite:!1,alphaTest:.1,sizeAttenuation:!0})}function getAspectRatioAdjustedScale(e,t=2.5){const o=_0x3d2e67;if(!e||!e[o(491)])return t;const a=e.image[o(409)]/e[o(491)][o(556)];return{x:a>1?t:t*a,y:a>1?t/a:t}}async function setupImageStreaming(){imageLoadingComplete=await fetchAndPrepareImageTextures(),imageLoadingComplete&&tweakSpawnParametersByImageCount()}function tweakSpawnParametersByImageCount(){const e=_0x3d2e67,t=IMAGE_CONFIG.count;t<=2?(IMAGE_CONFIG[e(415)]=300,minActiveImages=6,maxConcurrentImages=Math[e(339)](15,7.5*t)):t<=5?(IMAGE_CONFIG.spawnInterval=400,minActiveImages=8,maxConcurrentImages=Math[e(339)](18,3.5*t)):(IMAGE_CONFIG.spawnInterval=500,minActiveImages=8,maxConcurrentImages=Math[e(339)](30,Math[e(518)](2.5*t)))}function printImageSystemReport(){const e=_0x3d2e67;activeImages[e(424)],independentImageSprites[e(392)],freeImageIndices.length,imageSpawnQueue[e(392)]}function setupImageObjectPool(){const e=_0x3d2e67;if(imageLoadingComplete&&streamHeart){imagePool[e(311)]((t=>{const o=e;t&&t[o(420)]&&t[o(420)].remove(t)})),imagePool[e(392)]=0,activeImages.clear(),freeImageIndices[e(392)]=0;for(let t=0;t<IMAGE_CONFIG[e(400)];t++){const o=t%IMAGE_CONFIG[e(492)],a=imageTextures[o],s=buildImageSpriteMaterial(a,1),n=new _0x87c664.Sprite(s),r=getAspectRatioAdjustedScale(a,IMAGE_CONFIG[e(328)]);n.scale.set(r.x,r.y,1),n.visible=!1,n[e(342)]={poolIndex:t,textureIndex:o,isActive:!1,particleIndex:-1,aspectScale:r},streamHeart[e(513)](n),imagePool[e(408)](n),freeImageIndices[e(408)](t)}}}function retrieveImageFromPool(e){const t=_0x3d2e67;if(0===freeImageIndices[t(392)])return null;const o=freeImageIndices.pop(),a=imagePool[o],s=currentImageIndex%IMAGE_CONFIG[t(492)],n=imageTextures[s];a[t(479)][t(371)]=n,a[t(479)][t(426)]=!0;const r=getAspectRatioAdjustedScale(n,IMAGE_CONFIG[t(328)]);return a[t(328)].set(r.x,r.y,1),a.userData={...a[t(342)],aspectScale:r,textureIndex:s,isActive:!0,particleIndex:e},activeImages.set(e,o),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG[t(492)],a}function releaseImageToPool(e){const t=_0x3d2e67,o=activeImages[t(527)](e);if(void 0!==o){const a=imagePool[o];a.visible=!1,a[t(479)][t(380)]=0,a[t(342)][t(532)]=!1,a[t(342)][t(512)]=-1,activeImages[t(430)](e),freeImageIndices[t(408)](o)}}function controlImageSpawningLogic(e){const t=_0x3d2e67,o=activeImages.size+independentImageSprites[t(392)],a=o<minActiveImages,s=e-lastImageSpawnTime>=IMAGE_CONFIG.spawnInterval&&o<maxConcurrentImages;if(!a&&!s)return;(a||e>=nextIndependentSpawnTime)&&createFloatingImageSprite(e);let n=selectBestParticleForImageSpawn();-1!==n&&freeImageIndices[t(392)]>0&&(imageSpawnQueue[t(408)]({particleIndex:n,imageIndex:currentImageIndex%IMAGE_CONFIG[t(492)],spawnTime:e,isForced:a}),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG[t(492)],lastImageSpawnTime=e)}function createFloatingImageSprite(e){const t=_0x3d2e67,o=Math.ceil(.8*maxConcurrentImages);if(independentImageSprites[t(392)]>=o)return;const a=currentImageIndex%IMAGE_CONFIG[t(492)],s=imageTextures[a],n=buildImageSpriteMaterial(s,1),r=new(_0x87c664[t(452)])(n),i=getAspectRatioAdjustedScale(s,IMAGE_CONFIG[t(328)]);r[t(328)][t(320)](i.x,i.y,1),r[t(434)]=!1,r[t(342)]={isIndependent:!0,imageIndex:a,spawnTime:e,lifeDuration:6e3+2e3*Math[t(330)](),startY:planeYCenter,startX:0,startZ:0,aspectScale:i},streamHeart[t(513)](r),independentImageSprites[t(408)](r),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG[t(492)],lastImageSpawnTime=e,nextIndependentSpawnTime=e+1.2*IMAGE_CONFIG.spawnInterval}function animateFloatingImageSprites(e){const t=_0x3d2e67;for(let o=independentImageSprites.length-1;o>=0;o--){const a=independentImageSprites[o],s=a[t(342)],n=(e-s.spawnTime)/s.lifeDuration;if(n>=1){streamHeart[t(504)](a),independentImageSprites[t(450)](o,1);continue}a[t(434)]=!0;const r=1-Math[t(370)](1-n,2),i=planeYCenter,c=10+4*Math[t(360)](n*Math.PI*2),l=_0x87c664[t(395)][t(507)](i,c,r),d=1.5+s[t(404)]%5*.3,x=s[t(404)]%2==0?1:-1,m=n*d*Math.PI*2*x,_=(1-r)*(6+3*Math[t(360)](s[t(404)])),p=Math[t(453)](m)*_,h=Math[t(360)](m)*_;if(a[t(516)][t(320)](p,l,h),n<.1){a[t(479)].opacity=n/.1;const e=s[t(501)]||{x:IMAGE_CONFIG[t(328)],y:IMAGE_CONFIG.scale};a[t(328)][t(320)](e.x*(.5+5*n),e.y*(.5+5*n),1)}else if(n>.4){const e=(n-.4)/.6;a[t(479)].opacity=1-e;const o=1-.9*e,s=a[t(342)][t(501)]||{x:IMAGE_CONFIG[t(328)],y:IMAGE_CONFIG[t(328)]};a.scale.set(s.x*o,s.y*o,1),e>.9&&(a[t(434)]=!1)}else{a[t(479)].opacity=1;const e=s[t(501)]||{x:IMAGE_CONFIG[t(328)],y:IMAGE_CONFIG[t(328)]};a.scale[t(320)](e.x,e.y,1)}}}function selectBestParticleForImageSpawn(){const e=_0x3d2e67,t=[];for(let o=0;o<streamCount;o++)if(!activeImages[e(410)](o)){const a=streamState[o];t[e(408)]({index:o,state:a,priority:a===STATE_ASCEND?3:a===STATE_ON_DISK?2:1})}return 0===t[e(392)]?-1:(t[e(419)](((t,o)=>o[e(354)]-t[e(354)])),t[0][e(455)])}function handleQueuedImageSpawns(){const e=_0x3d2e67;for(;imageSpawnQueue[e(392)]>0;){const{particleIndex:t,imageIndex:o}=imageSpawnQueue[e(478)]();!activeImages[e(410)](t)&&freeImageIndices[e(392)]>0&&retrieveImageFromPool(t)}}function applyMobileSpecificSettings(){const e=_0x3d2e67;if(!document.querySelector(e(448))){const t=document[e(433)](e(375));t[e(335)]=e(488),t[e(526)]=e(347),document.head[e(385)](t)}document[e(345)][e(329)].overflow=e(489),document[e(345)][e(329)][e(516)]=e(559),document[e(345)].style[e(409)]=e(528),document[e(345)][e(329)][e(556)]="100%";/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[e(338)](navigator[e(353)])&&renderer.setPixelRatio(Math[e(339)](window[e(346)],2))}setupImageStreaming();let STAR_COUNT=0,starAlpha=null,starPhase=null,starGeo=null;const RingText=[...appData.messages];let cameraAnimationStart=null;const CAMERA_ANIMATION_DURATION=2.5;let CAMERA_START_POSITION={x:0,y:90,z:30};const CAMERA_END_POSITION={x:0,y:25,z:65};let userHasMovedCamera=!1,streamHeartStarted=!1,streamHeartActiveRatio=0,firstResetCompleted=!1;const scene=new _0x87c664.Scene,heartScene=new(_0x87c664[_0x3d2e67(341)]),renderer=new(_0x87c664[_0x3d2e67(431)])({antialias:!0,alpha:!0}),HEART_ROTATE=!1;let heartbeatEnabled=!1;const fadeObjects=[],explosionEffects=[],effectPool={waves:[],sparkles:[],texts:[]},POOL_SIZE=5,activeTexts=new Map;let isPulsing=!1,pulseStartTime=0;const PULSE_DURATION=.6,PULSE_AMPLITUDE=.15;let revealStart=null;const REVEAL_DURATION=1.5,HEARTBEAT_FREQ_HZ=.5,HEARTBEAT_AMPLITUDE=.05,STAGE={RIBBON:0,STREAM:1,STAR:2,SHOOT:3,HEART:4},STAGE_DURATION=.15;renderer.setPixelRatio(window[_0x3d2e67(346)]),renderer.setSize(window[_0x3d2e67(568)],window[_0x3d2e67(554)]),document[_0x3d2e67(345)][_0x3d2e67(385)](renderer[_0x3d2e67(555)]),applyMobileSpecificSettings();let staticBottomHeart=null,staticTopHeart=null;const camera=new(_0x87c664[_0x3d2e67(470)])(45,window.innerWidth/window[_0x3d2e67(554)],.1,300);camera[_0x3d2e67(516)][_0x3d2e67(320)](0,90,25),camera.lookAt(0,0,0);const controls=new OrbitControls(camera,renderer[_0x3d2e67(555)]);controls.enableDamping=!0,controls.minDistance=5,controls[_0x3d2e67(417)]=100,controls[_0x3d2e67(550)]=!0,controls[_0x3d2e67(310)]=_0x87c664[_0x3d2e67(395)][_0x3d2e67(459)](60),controls[_0x3d2e67(544)]=_0x87c664[_0x3d2e67(395)][_0x3d2e67(459)](135),controls[_0x3d2e67(482)]=!0;const planeGeo1=new(_0x87c664[_0x3d2e67(350)])(30,30),planeMat=new(_0x87c664[_0x3d2e67(462)])({color:16711935,side:_0x87c664.DoubleSide,visible:!1}),invisiblePlane=new(_0x87c664[_0x3d2e67(319)])(planeGeo1,planeMat);invisiblePlane[_0x3d2e67(461)].z=Math.PI,invisiblePlane[_0x3d2e67(516)].y=10,scene.add(invisiblePlane);const composerMain=new EffectComposer(renderer),renderPassMain=new RenderPass(scene,camera);renderPassMain[_0x3d2e67(524)]=!1,composerMain[_0x3d2e67(412)](renderPassMain);const composerHeart=new EffectComposer(renderer);composerHeart[_0x3d2e67(412)](new RenderPass(heartScene,camera));const afterimagePass=new AfterimagePass;afterimagePass.uniforms[_0x3d2e67(332)].value=.9,composerHeart[_0x3d2e67(412)](afterimagePass),scene[_0x3d2e67(513)](new _0x87c664.AmbientLight(16777215,.6));const p1=new _0x87c664.PointLight(16777215,1.2);p1[_0x3d2e67(516)][_0x3d2e67(320)](10,10,10),scene[_0x3d2e67(513)](p1);const p2=new(_0x87c664[_0x3d2e67(447)])(16738047,.8);function generateGlowCircleTexture(){const e=_0x3d2e67,t=document.createElement(e(553));t[e(409)]=256,t[e(556)]=256;const o=t[e(509)]("2d"),a=128,s=o.createRadialGradient(a,a,.4*127,a,a,127);s.addColorStop(0,e(425)),s[e(476)](1,e(490)),o.fillStyle=s,o[e(531)](),o[e(466)](a,a,127,0,2*Math.PI),o.closePath(),o.fill();const n=o.createRadialGradient(a,a,0,a,a,76.2);n[e(476)](0,"rgba(255,255,255,1)"),n[e(476)](1,"rgba(255,255,255,0)"),o.fillStyle=n,o[e(531)](),o[e(466)](a,a,76.2,0,2*Math.PI),o[e(308)](),o[e(432)]();const r=new _0x87c664.CanvasTexture(t);return r[e(563)]=_0x87c664[e(373)],r[e(562)]=_0x87c664[e(373)],r[e(426)]=!0,r}p2[_0x3d2e67(516)][_0x3d2e67(320)](-10,-10,-10),scene[_0x3d2e67(513)](p2);const circleTexture=generateGlowCircleTexture(),heartShape=new(_0x87c664[_0x3d2e67(565)]),x=0,y=0;heartShape[_0x3d2e67(481)](5,5),heartShape[_0x3d2e67(445)](5,5,4,0,0,0),heartShape[_0x3d2e67(445)](-6,0,-6,7,-6,7),heartShape[_0x3d2e67(445)](-6,11,-3,15.4,5,19),heartShape[_0x3d2e67(445)](12,15.4,16,11,16,7),heartShape[_0x3d2e67(445)](16,7,16,0,10,0),heartShape[_0x3d2e67(445)](7,0,5,5,5,5);const polyPts=heartShape[_0x3d2e67(530)](100);function isPointInsidePolygon(e,t){const o=_0x3d2e67;let a=!1;for(let s=0,n=t[o(392)]-1;s<t[o(392)];n=s++){const o=t[s].x,r=t[s].y,i=t[n].x,c=t[n].y;r>e.y!=c>e.y&&e.x<(i-o)*(e.y-r)/(c-r)+o&&(a=!a)}return a}const polyShift=polyPts[_0x3d2e67(371)]((e=>({x:e.x-5,y:e.y-7}))),BORDER_THRESHOLD=.1*(Math.max(...polyPts.map((e=>e.x)))-Math.min(...polyPts[_0x3d2e67(371)]((e=>e.x))));function calculateMinimumDistanceToBorder(e,t){const o=_0x3d2e67;let a=1/0;for(let s=0;s<polyShift[o(392)];s++){const n=polyShift[s],r=polyShift[(s+1)%polyShift.length],i=r.x-n.x,c=r.y-n.y,l=((e-n.x)*i+(t-n.y)*c)/(i*i+c*c),d=Math.max(0,Math[o(339)](1,l)),x=(e-(n.x+d*i))**2+(t-(n.y+d*c))**2;x<a&&(a=x)}return Math[o(334)](a)}const raycaster=new(_0x87c664[_0x3d2e67(495)]),mouse=new(_0x87c664[_0x3d2e67(324)]),HEART_CENTER_TARGET=new(_0x87c664[_0x3d2e67(357)])(0,10,0);function createHeartExplosion(e){const t=_0x3d2e67;mouse.x=e[t(520)]/window[t(568)]*2-1,mouse.y=-e[t(464)]/window[t(554)]*2+1,raycaster[t(440)](mouse,camera);const o=new(_0x87c664[t(357)]);raycaster[t(567)].at(explosionDistance,o);const a=new(_0x87c664[t(522)]),s=makeMat({map:circleTexture,blending:_0x87c664[t(337)],depthWrite:!1,alphaSupport:!0,vertexColors:!0}),n=30+20*Math[t(330)](),r=[],i=[],c=[],l=[],d=(new(_0x87c664[t(306)]))[t(456)](Math[t(330)](),.9,.7);for(let e=0;e<n;e++){r.push(o.x,o.y,o.z);const e=d[t(416)]()[t(471)](.2*Math[t(330)]()-.1,0,0);i[t(408)](e.r,e.g,e.b),c[t(408)](.8*Math[t(330)]()+.2);const a=Math.random()*Math.PI*2,s=Math[t(397)](2*Math.random()-1),n=15*Math[t(330)]()+10,x=new _0x87c664.Vector3;x[t(487)](1,a,s),l[t(408)](x[t(503)](n))}const x=new(_0x87c664[t(508)]);x[t(326)](t(516),new _0x87c664.Float32BufferAttribute(r,3)),x[t(326)](t(378),new(_0x87c664[t(497)])(i,3)),x[t(326)](t(424),new(_0x87c664[t(497)])(c,1));const m=new(_0x87c664[t(401)])(x,s);a[t(513)](m),a[t(342)][t(383)]=l,a[t(342)][t(486)]=1,scene[t(513)](a),explosionEffects.push(a)}function setupEffectPools(){const e=_0x3d2e67,t=document[e(433)](e(553));t[e(409)]=256,t[e(556)]=256;const o=t[e(509)]("2d"),a=o.createRadialGradient(128,128,0,128,128,128);a[e(476)](0,e(355)),a[e(476)](.3,e(336)),a.addColorStop(1,"rgba(255,255,255,0)"),o[e(322)]=a,o.fillRect(0,0,256,256);const s=new(_0x87c664[e(325)])(t);for(let t=0;t<5;t++){const t=new(_0x87c664[e(462)])({map:s,blending:_0x87c664[e(337)],transparent:!0,depthWrite:!1}),o=new(_0x87c664[e(319)])(new(_0x87c664[e(350)])(20,20),t);o.visible=!1,o[e(342)][e(514)]=!1,scene[e(513)](o),effectPool.waves[e(408)](o);const a=100,n=new(_0x87c664[e(508)]);n[e(326)](e(516),new(_0x87c664[e(472)])(new Float32Array(3*a),3)[e(363)](_0x87c664.DynamicDrawUsage));const r=makeMat({map:circleTexture,blending:_0x87c664[e(337)],alphaSupport:!0,depthWrite:!1}),i=new(_0x87c664[e(401)])(n,r);i[e(434)]=!1,i[e(342)][e(514)]=!1,scene[e(513)](i),effectPool[e(467)].push(i)}const n=appData?.[e(318)]||[],r=(appData?.[e(318)]||[])[e(304)](" ")[e(498)](" ");[...new Set(r[e(358)]((e=>e.length>0)))][e(311)]((t=>{const o=e,a=createFlyingTextTexture(t),s=new _0x87c664.SpriteMaterial({map:a,transparent:!0,depthWrite:!1,blending:_0x87c664[o(337)]}),n=new(_0x87c664[o(452)])(s),r=a.image[o(409)]/a.image[o(556)];n[o(328)][o(320)](1.5*r,1.5,1),n[o(434)]=!1,n[o(342)].active=!1,n[o(342)][o(542)]=t,streamHeart[o(513)](n),effectPool[o(315)][o(408)](n)})),n[e(311)]((t=>{const o=e,a=createFlyingTextTexture(t),s=new _0x87c664.SpriteMaterial({map:a,transparent:!0,depthWrite:!1,blending:_0x87c664[o(337)]}),n=new _0x87c664.Sprite(s),r=a[o(491)][o(409)]/a.image[o(556)];n[o(328)].set(2*r,2,1),n[o(434)]=!1,n[o(342)][o(514)]=!1,streamHeart[o(513)](n),effectPool[o(315)].push(n)}))}function releaseTextToPool(e){const t=_0x3d2e67;if(activeTexts[t(410)](e)){const o=activeTexts[t(527)](e);o[t(434)]=!1,o.userData[t(514)]=!1,activeTexts[t(430)](e)}}function createFlyingTextTexture(e){const t=_0x3d2e67,o=document[t(433)](t(553));o[t(409)]=1024,o[t(556)]=128;const a=o.getContext("2d");a[t(422)]=t(494),a[t(384)]=t(309),a[t(317)]=t(551),a.strokeStyle=t(406),a[t(314)]=8,a[t(570)](e,o[t(409)]/2,o.height/2),a[t(322)]=t(394),a[t(561)](e,o[t(409)]/2,o[t(556)]/2);const s=new _0x87c664.CanvasTexture(o);return s[t(563)]=_0x87c664[t(373)],s[t(562)]=_0x87c664[t(373)],s}const positions=[],sampleCount=7e3,xs=polyPts.map((e=>e.x)),ys=polyPts[_0x3d2e67(371)]((e=>e.y)),minX=Math.min(...xs),maxX=Math[_0x3d2e67(511)](...xs),minY=Math[_0x3d2e67(339)](...ys),maxY=Math[_0x3d2e67(511)](...ys),threshold=minY+(maxY-minY)/6;for(;positions[_0x3d2e67(392)]/3<7e3;){const e=Math[_0x3d2e67(330)]()*(maxX-minX)+minX,t=Math[_0x3d2e67(330)]()*(maxY-minY)+minY;if(isPointInsidePolygon({x:e,y:t},polyPts)){let o=1/0;for(let a=0;a<polyPts[_0x3d2e67(392)];a++){const s=polyPts[a],n=polyPts[(a+1)%polyPts.length],r=n.x-s.x,i=n.y-s.y,c=((e-s.x)*r+(t-s.y)*i)/(r*r+i*i),l=Math.max(0,Math.min(1,c)),d=e-(s.x+l*r),x=t-(s.y+l*i),m=d*d+x*x;m<o&&(o=m)}const a=1/(1+2*Math.sqrt(o));if(Math[_0x3d2e67(330)]()<a){const o=3.6*(Math.random()-.5);positions.push(e-5,t-7,o)}}}let minZ=1/0,maxZval=-1/0;for(let e=2;e<positions[_0x3d2e67(392)];e+=3){const t=positions[e];t<minZ&&(minZ=t),t>maxZval&&(maxZval=t)}const heartDepth=maxZval-minZ,heartWidth=maxX-minX,planeXVar=2*heartWidth,rStreamStart=.8*heartWidth,Rmax=rStreamStart,rVortex=.6*heartWidth,planeZVar=15*heartDepth,planeYCenter=maxY,planeYVar=1,riseDuration=10,fallDuration=0,holdDuration=0,STREAM_RISE_MIN=8,STREAM_RISE_MAX=12,INDENT_Y=maxY-.25*(maxY-minY),INDENT_HALF_WIDTH=.35*heartWidth,COS_ANGLE_THRESH=.707106,CLIP_FRONT_Z=.3,staticGeo=new(_0x87c664[_0x3d2e67(508)]),originalPositions=positions[_0x3d2e67(356)]();staticGeo[_0x3d2e67(326)](_0x3d2e67(516),new _0x87c664.Float32BufferAttribute(originalPositions,3));const colors=[];for(let e=0;e<positions[_0x3d2e67(392)];e+=3)colors[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b);staticGeo[_0x3d2e67(326)](_0x3d2e67(378),new(_0x87c664[_0x3d2e67(497)])(colors,3));const staticSizes=new Float32Array(positions[_0x3d2e67(392)]/3),SIZE_SCALE=2;for(let e=0;e<staticSizes[_0x3d2e67(392)];e++)staticSizes[e]=2*(.3*Math.random()+.2);staticGeo[_0x3d2e67(326)](_0x3d2e67(424),new _0x87c664.Float32BufferAttribute(staticSizes,1));const topIndices=[];for(let e=0;e<positions.length;e+=3)positions[e+1]>threshold+.1*(Math.random()-.5)*(maxY-minY)&&topIndices[_0x3d2e67(408)](e/3);const topSet=new Set(topIndices);let bottomPositions=[];const bottomColors=[],bottomSizes=[],bottomSizesBase=[],topPositionsArr=[],topColors=[],topSizes=[],topAlpha=[],idxToTopIdx=new Int32Array(positions[_0x3d2e67(392)]/3).fill(-1);for(let e=0,t=0;e<positions[_0x3d2e67(392)];e+=3){const o=e/3,a=staticSizes[o],s=positions[e],n=positions[e+1],r=positions[e+2];if(topSet.has(o)){topPositionsArr[_0x3d2e67(408)](s,n,r),topColors[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),topSizes[_0x3d2e67(408)](a);const e=Math[_0x3d2e67(533)](s)<INDENT_HALF_WIDTH&&n>INDENT_Y;topAlpha.push(e?0:1),idxToTopIdx[o]=t++}else bottomPositions[_0x3d2e67(408)](s,n,r),bottomColors.push(heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),bottomSizes.push(a)}staticGeo[_0x3d2e67(326)](_0x3d2e67(516),new(_0x87c664[_0x3d2e67(497)])(topPositionsArr,3)),staticGeo[_0x3d2e67(326)](_0x3d2e67(378),new _0x87c664.Float32BufferAttribute(topColors,3)),staticGeo[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(497)])(topSizes,1)),staticGeo[_0x3d2e67(326)](_0x3d2e67(359),new(_0x87c664[_0x3d2e67(472)])(new Float32Array(topAlpha),1)),staticGeo[_0x3d2e67(449)][_0x3d2e67(516)][_0x3d2e67(426)]=!0,staticGeo[_0x3d2e67(449)].alpha.needsUpdate=!0;const topCount=topPositionsArr[_0x3d2e67(392)]/3,topRadiusArr=new Float32Array(topCount),topPhaseArr=new Float32Array(topCount),topDelayArr=new Float32Array(topCount);for(let e=0;e<topCount;e++){const t=topPositionsArr[3*e],o=topPositionsArr[3*e+2],a=Math.sqrt(t*t+o*o);topRadiusArr[e]=a,topPhaseArr[e]=Math[_0x3d2e67(398)](o,t),topDelayArr[e]=10*Math.random()}const GLOBAL_SPIRAL_FREQ=.5,BASE_OMEGA=-1*Math.PI/10,GATHER_RATIO=.01,HOLD_RATIO=.2,radiusPow=2.5,rCore=.25,rOuter=rVortex,vIn=.9,SHRINK_TO_CORE=!1,BURST_SPREAD=.1,FADE_DURATION=1.5,SPAWN_DELAY_MAX=3,ASCEND_DELAY_MAX=10,apexY=maxY,LOW_REGION_FACTOR=.5;let minBottomY=1/0,maxBottomY=-1/0;for(let e=1;e<bottomPositions[_0x3d2e67(392)];e+=3){const t=bottomPositions[e];t<minBottomY&&(minBottomY=t),t>maxBottomY&&(maxBottomY=t)}const Y_THRESHOLD=minBottomY+.5*(maxBottomY-minBottomY),HIGH_BOTTOM_MULT=2;{const e=[],t=[],o=[];for(let a=0;a<bottomPositions[_0x3d2e67(392)];a+=3){const s=bottomPositions[a+1];if(s>=Y_THRESHOLD)for(let n=1;n<2;n++)e[_0x3d2e67(408)](bottomPositions[a],s,bottomPositions[a+2]),t[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),o[_0x3d2e67(408)](bottomSizes[a/3])}bottomPositions.push(...e),bottomColors[_0x3d2e67(408)](...t),bottomSizes[_0x3d2e67(408)](...o)}const BOTTOM_ROTATE_RATIO=.2,rotPos=[],rotColors=[],rotSizes=[],staticBotPos=[],staticBotColors=[],staticBotSizes=[];for(let e=0;e<bottomPositions[_0x3d2e67(392)];e+=3)Math.random()<.2?(rotPos[_0x3d2e67(408)](bottomPositions[e],bottomPositions[e+1],bottomPositions[e+2]),rotColors[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),rotSizes[_0x3d2e67(408)](bottomSizes[e/3])):(staticBotPos[_0x3d2e67(408)](bottomPositions[e],bottomPositions[e+1],bottomPositions[e+2]),staticBotColors[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),staticBotSizes.push(bottomSizes[e/3]));bottomPositions[_0x3d2e67(392)]=0,bottomPositions.push(...rotPos),bottomColors[_0x3d2e67(392)]=0,bottomColors[_0x3d2e67(408)](...rotColors),bottomSizes[_0x3d2e67(392)]=0,bottomSizes[_0x3d2e67(408)](...rotSizes);const bottomCount=bottomPositions[_0x3d2e67(392)]/3,bottomRadiusArr=new Float32Array(bottomCount),bottomPhaseArr=new Float32Array(bottomCount),bottomDelayArr=new Float32Array(bottomCount),CLEFT_FACTOR=2.5,bottomAlphaArr=new Float32Array(bottomCount)[_0x3d2e67(432)](1),bottomIsLow=new Uint8Array(bottomCount),pivotOffset=.25*heartWidth,KEEP_LOW_MIN=0,KEEP_LOW_MAX=.3;for(let e=0;e<bottomCount;e++){const t=bottomPositions[3*e],o=bottomPositions[3*e+1],a=bottomPositions[3*e+2],s=o<Y_THRESHOLD;if(bottomIsLow[e]=s?1:0,s){const t=0+(o-minBottomY)/(Y_THRESHOLD-minBottomY)*.3;bottomAlphaArr[e]=Math[_0x3d2e67(330)]()<t?1:0}else bottomAlphaArr[e]=1;const n=Math.sqrt(t*t+a*a),r=Math[_0x3d2e67(398)](a,t),i=Math[_0x3d2e67(339)](1,Math[_0x3d2e67(533)](t)/(.25*heartWidth)),c=1.5*Math[_0x3d2e67(370)](1-i,3)+1;bottomRadiusArr[e]=n*c,bottomPhaseArr[e]=r,bottomDelayArr[e]=10*Math[_0x3d2e67(330)]()}const bottomAlphaBase=Float32Array[_0x3d2e67(407)](bottomAlphaArr),bottomGeo=new _0x87c664.BufferGeometry;bottomGeo.setAttribute(_0x3d2e67(516),new(_0x87c664[_0x3d2e67(497)])(bottomPositions,3)),bottomGeo[_0x3d2e67(326)]("color",new _0x87c664.Float32BufferAttribute(bottomColors,3)[_0x3d2e67(363)](_0x87c664.DynamicDrawUsage)),bottomGeo[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(497)])(bottomSizes,1)),bottomGeo.setAttribute(_0x3d2e67(359),new(_0x87c664[_0x3d2e67(472)])(bottomAlphaArr,1));const V_SLOPE=.3,matBottom=makeMat({map:circleTexture,alphaSupport:!0,vClipSlope:.3,clipFrontZ:.3});matBottom[_0x3d2e67(443)]=.5;const bottomHeart=new _0x87c664.Points(bottomGeo,matBottom);bottomHeart.rotation.z=Math.PI,bottomHeart[_0x3d2e67(463)]=0,scene[_0x3d2e67(513)](bottomHeart);const BOTTOM_OMEGA=BASE_OMEGA,topPointVisibility=new Array(topIndices[_0x3d2e67(392)])[_0x3d2e67(432)](!0);let hiddenTopCount=0;const matStatic=makeMat({map:circleTexture,alphaSupport:!0});matStatic[_0x3d2e67(443)]=.5;const staticHeart=new(_0x87c664[_0x3d2e67(401)])(staticGeo,matStatic);function _0x48ee(e,t){const o=_0x7cf8();return(_0x48ee=function(e,t){return o[e-=304]})(e,t)}staticHeart.rotation.z=Math.PI,staticHeart[_0x3d2e67(463)]=0,scene[_0x3d2e67(513)](staticHeart);const TOP_STATIC_RATIO=.5;{const e=[],t=[],o=[];for(let a=0;a<topPositionsArr[_0x3d2e67(392)];a+=3){const s=calculateMinimumDistanceToBorder(topPositionsArr[a]+5,topPositionsArr[a+1]+7)<BORDER_THRESHOLD||Math[_0x3d2e67(330)]()<.3;Math[_0x3d2e67(330)]()<.5&&s&&(e.push(topPositionsArr[a],topPositionsArr[a+1],topPositionsArr[a+2]),t[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),o[_0x3d2e67(408)](topSizes[Math[_0x3d2e67(413)](a/3)]))}if(e[_0x3d2e67(392)]){const a=new(_0x87c664[_0x3d2e67(508)]);a[_0x3d2e67(326)](_0x3d2e67(516),new(_0x87c664[_0x3d2e67(497)])(e,3)),a[_0x3d2e67(326)](_0x3d2e67(378),new _0x87c664.Float32BufferAttribute(t,3).setUsage(_0x87c664[_0x3d2e67(547)])),a.setAttribute(_0x3d2e67(424),new(_0x87c664[_0x3d2e67(497)])(o,1));const s=makeMat({map:circleTexture,alphaSupport:!0});s[_0x3d2e67(443)]=.5,staticTopHeart=new _0x87c664.Points(a,s),staticTopHeart.rotation.z=Math.PI,staticTopHeart[_0x3d2e67(463)]=0,scene.add(staticTopHeart)}}if(staticBotPos.length>0){const e=new(_0x87c664[_0x3d2e67(508)]);e[_0x3d2e67(326)](_0x3d2e67(516),new(_0x87c664[_0x3d2e67(497)])(staticBotPos,3)),e[_0x3d2e67(326)](_0x3d2e67(378),new(_0x87c664[_0x3d2e67(497)])(staticBotColors,3).setUsage(_0x87c664[_0x3d2e67(547)])),e[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(497)])(staticBotSizes,1));const t=makeMat({map:circleTexture,alphaSupport:!0});t[_0x3d2e67(443)]=.5,staticBottomHeart=new _0x87c664.Points(e,t),staticBottomHeart[_0x3d2e67(461)].z=Math.PI,staticBottomHeart[_0x3d2e67(463)]=0,scene[_0x3d2e67(513)](staticBottomHeart)}const SPAWN_MULT=.2,rimIndices=[];for(const e of topIndices)calculateMinimumDistanceToBorder(positions[3*e],positions[3*e+1])<BORDER_THRESHOLD&&rimIndices[_0x3d2e67(408)](e);const streamSource=rimIndices[_0x3d2e67(392)]?rimIndices:topIndices,streamCount=Math.floor(.2*streamSource[_0x3d2e67(392)]),targetIdxArr=new Uint32Array(streamCount);for(let e=0;e<streamCount;e++)targetIdxArr[e]=streamSource[e%streamSource[_0x3d2e67(392)]];const planeIdxForStream=new Int32Array(streamCount)[_0x3d2e67(432)](-1),streamPositions=new Float32Array(3*streamCount),streamGeo=new(_0x87c664[_0x3d2e67(508)]),streamAlpha=new Float32Array(streamCount)[_0x3d2e67(432)](1);streamGeo.setAttribute(_0x3d2e67(359),new(_0x87c664[_0x3d2e67(472)])(streamAlpha,1)),streamGeo[_0x3d2e67(326)](_0x3d2e67(516),new(_0x87c664[_0x3d2e67(472)])(streamPositions,3).setUsage(_0x87c664.DynamicDrawUsage));const streamColors=new Float32Array(3*streamCount);for(let e=0;e<streamCount;e++)streamColors[3*e]=heartInitialColor.r,streamColors[3*e+1]=heartInitialColor.g,streamColors[3*e+2]=heartInitialColor.b;streamGeo.setAttribute("color",new(_0x87c664[_0x3d2e67(472)])(streamColors,3));const streamSizes=new Float32Array(streamCount);for(let e=0;e<streamCount;e++)streamSizes[e]=2*(.3*Math[_0x3d2e67(330)]()+.2+.1)*1;const streamSizeBase=streamSizes[_0x3d2e67(356)](),BIG_RATIO=.1;for(let e=0;e<streamCount;e++)Math[_0x3d2e67(330)]()<.1&&(streamSizes[e]*=1.5,streamColors[3*e]=heartInitialColor.r,streamColors[3*e+1]=heartInitialColor.g,streamColors[3*e+2]=heartInitialColor.b);streamGeo[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(472)])(streamSizes,1));const matStream=makeMat({map:circleTexture,alphaSupport:!0,clipBandWidth:INDENT_HALF_WIDTH,clipFrontZ:.3});matStream.alphaTest=.5;const streamHeart=new _0x87c664.Points(streamGeo,matStream);streamHeart.rotation.z=Math.PI,streamHeart.renderOrder=1,scene[_0x3d2e67(513)](streamHeart),streamHeart[_0x3d2e67(434)]=!1,fadeObjects.push(streamHeart),streamHeart.userData.fadeStage=STAGE[_0x3d2e67(391)];const PLANE_COUNT=Math[_0x3d2e67(413)](120*rVortex),planePositions=[],planeColors=[],planeSizes=[],planeAlphaArr=new Float32Array(PLANE_COUNT)[_0x3d2e67(432)](1);for(let e=0;e<PLANE_COUNT;e++){const e=Math.random()*Math.PI*2,t=Math[_0x3d2e67(334)](Math[_0x3d2e67(330)]())*rVortex;planePositions[_0x3d2e67(408)](Math.cos(e)*t,planeYCenter-7.5,Math[_0x3d2e67(360)](e)*t),planeColors[_0x3d2e67(408)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),planeSizes[_0x3d2e67(408)](1*Math[_0x3d2e67(330)]()+.25)}const planeGeo=new(_0x87c664[_0x3d2e67(508)]);planeGeo[_0x3d2e67(326)](_0x3d2e67(516),new(_0x87c664[_0x3d2e67(497)])(planePositions,3)),planeGeo[_0x3d2e67(326)]("color",new _0x87c664.Float32BufferAttribute(planeColors,3)),planeGeo[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(497)])(planeSizes,1)),planeGeo[_0x3d2e67(326)](_0x3d2e67(359),new _0x87c664.BufferAttribute(planeAlphaArr,1));const matPlane=makeMat({map:circleTexture,alphaSupport:!0});matPlane[_0x3d2e67(443)]=.5;const planeLayer=new(_0x87c664[_0x3d2e67(401)])(planeGeo,matPlane);planeLayer[_0x3d2e67(461)].z=Math.PI,scene.add(planeLayer),fadeObjects[_0x3d2e67(408)](planeLayer),fadeObjects.includes(planeLayer)&&fadeObjects[_0x3d2e67(450)](fadeObjects[_0x3d2e67(372)](planeLayer),1),planeLayer[_0x3d2e67(434)]=!0;const PLANE_COLOR_CYCLE=9,PLANE_COL_WHITE=new(_0x87c664[_0x3d2e67(306)])("rgb(255, 227, 249)"),PLANE_COL_LIGHT=new(_0x87c664[_0x3d2e67(306)])(_0x3d2e67(421)),PLANE_COL_DARK=new _0x87c664.Color(_0x3d2e67(444));function createTextSpriteTexture(e){const t=_0x3d2e67,o=document[t(433)](t(553));o.width=o[t(556)]=128;const a=o[t(509)]("2d");a[t(322)]="rgba(0,0,0,0)",a[t(473)](0,0,128,128),a[t(384)]="center",a[t(317)]="middle",a[t(422)]=t(313),a[t(314)]=7.68,a[t(451)]=t(406),a[t(570)](e,64,64),a[t(322)]=t(394),a[t(561)](e,64,64);const s=new _0x87c664.CanvasTexture(o);return s[t(563)]=s[t(562)]=_0x87c664[t(373)],s}planeGeo[_0x3d2e67(449)].color[_0x3d2e67(363)](_0x87c664[_0x3d2e67(547)]);const ringCharsFull=RingText[_0x3d2e67(304)](""),ringChars=Array[_0x3d2e67(407)](ringCharsFull),charMatMap={};function generateTextRingTexture(e){const t=_0x3d2e67,o=document.createElement("canvas");o[t(409)]=2048,o[t(556)]=256;const a=o[t(509)]("2d");a[t(322)]=t(502),a[t(473)](0,0,o[t(409)],o.height),a[t(422)]=t(368),a[t(384)]="center",a[t(317)]="middle";const s=o[t(556)]/e[t(392)];e[t(311)](((e,n)=>{const r=t,i=(n+.5)*s;a[r(548)]="#ff40c8",a[r(327)]=0,a.fillStyle=r(477),a[r(561)](e,o.width/2,i),a[r(327)]=0,a.strokeStyle="rgba(160, 30, 95, 0.9)",a[r(314)]=3,a[r(570)](e,o[r(409)]/2,i),a[r(322)]=r(394),a[r(561)](e,o.width/2,i)}));const n=new(_0x87c664[t(325)])(o);return n[t(426)]=!0,n}[...new Set(ringChars)][_0x3d2e67(311)]((e=>{const t=_0x3d2e67;charMatMap[e]=new(_0x87c664[t(442)])({map:createTextSpriteTexture(e),transparent:!0,depthWrite:!1})}));const ringTexture=generateTextRingTexture(RingText),ringMat=new _0x87c664.MeshBasicMaterial({map:ringTexture,transparent:!0,side:_0x87c664[_0x3d2e67(519)],depthWrite:!1,blending:_0x87c664[_0x3d2e67(337)]}),RING_THICKNESS=3.5,RING_HUE_SPEED=.05,RING_FADE_DIST=1,RING_FADE_SPEED=2,ringHeight=.8,RING_Y_OFFSET=2*-planeYCenter-.5,ringGeo=new(_0x87c664[_0x3d2e67(454)])(rVortex,rVortex,1,128,1,!0),RING_SPACING=2,RING_START_RADIUS=rVortex,RING_END_RADIUS=.25,RING_COUNT=Math[_0x3d2e67(518)]((RING_START_RADIUS-.25)/2),RING_FLIP_Y=Math.PI,ribbon=new(_0x87c664[_0x3d2e67(522)]);ribbon[_0x3d2e67(516)][_0x3d2e67(320)](0,planeYCenter+RING_Y_OFFSET,0),ribbon[_0x3d2e67(461)].z=Math.PI,scene.add(ribbon),ribbon[_0x3d2e67(434)]=!0;for(let e=0;e<RING_COUNT;e++){const t=generateTextRingTexture([RingText[e%RingText[_0x3d2e67(392)]]]);t.wrapS=_0x87c664[_0x3d2e67(402)],t[_0x3d2e67(483)][_0x3d2e67(320)](2,1),t.offset.x=1;const o=new(_0x87c664[_0x3d2e67(462)])({map:t,transparent:!0,side:_0x87c664[_0x3d2e67(519)],depthWrite:!1,blending:_0x87c664[_0x3d2e67(337)]}),a=new _0x87c664.Mesh(ringGeo,o);a[_0x3d2e67(461)].x=Math.PI;const s=RING_START_RADIUS-2*e,n=2*(Math[_0x3d2e67(330)]()-.5)*.3;a[_0x3d2e67(342)][_0x3d2e67(352)]=s+n,a[_0x3d2e67(342)][_0x3d2e67(396)]=Math.random()*Math.PI*2;const r=s/RING_START_RADIUS;a[_0x3d2e67(328)][_0x3d2e67(320)](r,3.5,r),a[_0x3d2e67(479)][_0x3d2e67(380)]=1,a[_0x3d2e67(479)].transparent=!0,a[_0x3d2e67(479)][_0x3d2e67(367)]=!1,a[_0x3d2e67(463)]=e,ribbon.add(a)}const vortexIndices=[];for(let e=0;e<positions[_0x3d2e67(392)]/3;e++)topIndices.includes(e)||vortexIndices[_0x3d2e67(408)](e);const vortexCount=vortexIndices[_0x3d2e67(392)],vortexPositions=new Float32Array(3*vortexCount),vortexPhase=new Float32Array(vortexCount),vortexRadius=new Float32Array(vortexCount);for(let e=0;e<vortexCount;e++){vortexPhase[e]=Math[_0x3d2e67(330)]()*Math.PI*2;const t=Math[_0x3d2e67(330)]()*rVortex;vortexRadius[e]=t,vortexPositions[3*e]=Math[_0x3d2e67(453)](vortexPhase[e])*t,vortexPositions[3*e+1]=planeYCenter,vortexPositions[3*e+2]=Math[_0x3d2e67(360)](vortexPhase[e])*t}const vortexGeo=new(_0x87c664[_0x3d2e67(508)]);vortexGeo[_0x3d2e67(326)](_0x3d2e67(516),new _0x87c664.BufferAttribute(vortexPositions,3).setUsage(_0x87c664[_0x3d2e67(547)]));const vortexColors=new Float32Array(3*vortexCount);for(let e=0;e<vortexCount;e++)vortexColors[3*e]=heartInitialColor.r,vortexColors[3*e+1]=heartInitialColor.g,vortexColors[3*e+2]=heartInitialColor.b;vortexGeo.setAttribute("color",new _0x87c664.BufferAttribute(vortexColors,3));const vortexSizes=new Float32Array(vortexCount);for(let e=0;e<vortexCount;e++)vortexSizes[e]=.2*Math.random()+.15;vortexGeo[_0x3d2e67(326)](_0x3d2e67(424),new(_0x87c664[_0x3d2e67(472)])(vortexSizes,1));const vortexMat=makeMat({map:circleTexture,blending:_0x87c664[_0x3d2e67(337)],opacity:.8});vortexMat[_0x3d2e67(436)]=function(e){const t=_0x3d2e67;e[t(572)]=e[t(572)][t(506)]("uniform float size;",t(387))};const heartLayers=[staticHeart,bottomHeart,staticBottomHeart,staticTopHeart];heartLayers.forEach((e=>{const t=_0x3d2e67;e&&(scene.remove(e),heartScene[t(513)](e))})),heartLayers.forEach((e=>{const t=_0x3d2e67;e&&(e.visible=!1,e[t(342)][t(552)]=STAGE[t(484)],fadeObjects.includes(e)||fadeObjects.push(e))}));const HEART_OFFSET_Y=10;function _0x7cf8(){const e=["rgba(255,20,147,0)","image","count","SHOOT",'bold 70px "Mali", sans-serif',"Raycaster","log","Float32BufferAttribute","split","spawnTime","render","aspectScale","rgba(0,0,0,0)","multiplyScalar","remove","#include <project_vertex>","replace","lerp","BufferGeometry","getContext","loop","max","particleIndex","add","active","touchend","position","matrixWorld","ceil","DoubleSide","clientX","gesturechange","Group","innerHTML","clear","hypot","content","get","100%","then","getPoints","beginPath","isActive","abs","10760EXdavD","lookAt","pause","play","matrixWorldInverse","Heartlove","autoClear","html, body {\n  background: #000 !important;\n  color-scheme: dark;\n  margin: 0;\n  padding: 0;\n  height: 100%;\n  overflow: hidden;\n  font-family: Arial, sans-serif;\n  position: fixed;\n  width: 100%;\n  top: 0;\n  left: 0;\n}\n\nbody {\n  background: #000;\n  background: radial-gradient(circle, #111 0%, #000 100%);\n}\n\ncanvas {\n  display: block;\n  touch-action: manipulation;\n  user-select: none;\n  -webkit-user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n@media screen and (max-width: 768px) {\n  canvas {\n    max-width: 100vw;\n    max-height: 100vh;\n  }\n  * {\n    touch-action: manipulation;\n  }\n}\n@supports (-webkit-touch-callout: none) {\n  body {\n    -webkit-overflow-scrolling: touch;\n    -webkit-user-select: none;\n    -webkit-tap-highlight-color: transparent;\n  }\n}\n #musicToggle {\n    position: fixed;\n    top: 16px;\n    right: 16px;\n    font-size: 22px;\n    background: rgba(255, 255, 255, 0);\n    border: 1px solid #ccc;\n    border-radius: 50%;\n    width: 48px;\n    height: 48px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    z-index: 999;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n    transition: background 0.3s ease;\n  }\n  #musicToggle:hover {\n    background: rgba(255, 255, 255, 0);\n  }","text","gesturestart","maxPolarAngle","musicToggle","waves","DynamicDrawUsage","shadowColor","clamp","enableZoom","middle","fadeStage","canvas","innerHeight","domElement","height","format","Không tìm thấy dữ liệu trong link. Sử dụng dữ liệu mặc định.","fixed","hostname","fillText","magFilter","minFilter","#ff69b400","Shape","location","ray","innerWidth","4109cxCGxn","strokeText","830txJjnP","vertexShader","find","parse","join",'"></i>',"Color","gestureend","closePath","center","minPolarAngle","forEach","386452ZVRGUX",'300 70.4px "Mali","Comfortaa","Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"lineWidth","texts","4262196WYXSOT","textBaseline","messages","Mesh","set","983045zCgDoA","fillStyle","#include <project_vertex>\n  vAlpha = alpha;","Vector2","CanvasTexture","setAttribute","shadowBlur","scale","style","random","198528xVfTyO","damp","images","sqrt","name","rgba(255,255,255,0.5)","AdditiveBlending","test","min","1147130CDqvIQ","Scene","userData","baseOpacity","load","body","devicePixelRatio","width=device-width, initial-scale=1.0, user-scalable=no","void main() {","geometry","PlaneGeometry","#ff9090","radius","userAgent","priority","rgba(255,255,255,1)","slice","Vector3","filter","alpha","sin","click","30zBWUVI","setUsage","44CPLZBq","update","copy","depthWrite",'bold 80px "Mali", sans-serif',"music","pow","map","indexOf","LinearFilter","resize","meta","panbap.github.io","paths","color","pointerdown","opacity","uniform float size;","children","velocities","textAlign","appendChild","STAR","attribute float size;","catch","heartColor","mãi yêu em","STREAM","length","Dữ liệu không hợp lệ:","#ffffff","MathUtils","phase","acos","atan2","innerText","maxActiveImages","Points","RepeatWrapping","getAzimuthalAngle","imageIndex","Image config:","rgba(160, 30, 95, 0.9)","from","push","width","has","applyMatrix4","addPass","floor","traverse","spawnInterval","clone","maxDistance","twinkleSpeed","sort","parent","rgb(255,192,215)","font","normalize","size","rgba(255,105,180,0.6)","needsUpdate","gl_FragColor = vec4( outgoingLight, diffuseColor.a * vAlpha );","setRGB","array","delete","WebGLRenderer","fill","createElement","visible","fragmentShader","onBeforeCompile","head","createRadialGradient","preventDefault","setFromCamera","attribute float size; attribute float alpha; varying float vAlpha;","SpriteMaterial","alphaTest","rgb(241, 121, 185)","bezierCurveTo","Tự động phát bị chặn.","PointLight",'meta[name="viewport"]',"attributes","splice","strokeStyle","Sprite","cos","CylinderGeometry","index","setHSL","fa-volume-xmark","getElapsedTime","degToRad","data","rotation","MeshBasicMaterial","renderOrder","clientY","gl_FragColor = vec4( outgoingLight, diffuseColor.a );","arc","sparkles","RGBAFormat","176517wZkgkH","PerspectiveCamera","offsetHSL","BufferAttribute","fillRect","button","addEventListener","addColorStop","#ff40c8","shift","material","creationTime","moveTo","enablePan","repeat","HEART","isSprite","life","setFromSphericalCoords","viewport","hidden"];return(_0x7cf8=function(){return e})()}[staticHeart,bottomHeart,staticTopHeart,staticBottomHeart][_0x3d2e67(311)]((e=>{e&&(e[_0x3d2e67(516)].y+=10)}));const HEART_OFFSET_YY=8;[streamHeart,ribbon][_0x3d2e67(311)]((e=>{e&&(e[_0x3d2e67(516)].y+=8)}));const ENABLE_EXPLOSION=!1;let expPositions,expVelocities,expBirth,expGeo,expColors,expMat,explosionPoints,MAX_EXP,expCount=0;const startTimes=new Float32Array(streamCount),STATE_ON_DISK=0,STATE_ASCEND=1,streamState=new Uint8Array(streamCount),curRadiusArr=new Float32Array(streamCount),ascendStart=new Float32Array(streamCount),spiralPhase=new Float32Array(streamCount),streamRadius=new Float32Array(streamCount),initialRadius=new Float32Array(streamCount),spiralFrequency=new Float32Array(streamCount),spiralDirection=new Float32Array(streamCount),extraRotArr=new Float32Array(streamCount),MAX_TOP_HIDE=Math[_0x3d2e67(413)](1*topIndices[_0x3d2e67(392)]),HIDE_DISTANCE=.25,TOP_ROT_SPEED=.5,streamRiseDuration=new Float32Array(streamCount),streamOffsets=new Float32Array(3*streamCount);for(let e=0;e<streamCount;e++){const t=3*e,o=Math[_0x3d2e67(330)]()*Math.PI*2,a=Math.acos(2*Math[_0x3d2e67(330)]()-1),s=.4;streamOffsets[t]=s*Math.sin(a)*Math[_0x3d2e67(453)](o),streamOffsets[t+1]=s*Math[_0x3d2e67(360)](a)*Math.sin(o),streamOffsets[t+2]=s*Math.cos(a)}function initializeStreamParticleState(e,t){const o=_0x3d2e67,a=3*e,s=targetIdxArr[e];let n=-1;for(let e=0;e<100;e++){const e=Math[o(413)](Math.random()*PLANE_COUNT),t=planePositions[3*e],a=planePositions[3*e+2];if(Math[o(525)](t,a)<=.26){n=e;break}}-1===n&&(n=Math.floor(Math[o(330)]()*PLANE_COUNT)),planeIdxForStream[e]=n;const r=Math[o(330)]()*Math.PI*2;planePositions[3*n]=Math.cos(r)*rOuter,planePositions[3*n+2]=Math[o(360)](r)*rOuter,planeGeo[o(449)][o(516)][o(426)]=!0;const i=planeLayer[o(461)].y,c=Math[o(453)](i),l=Math.sin(i),d=c*planePositions[3*n]-l*planePositions[3*n+2],x=l*planePositions[3*n]+c*planePositions[3*n+2];streamPositions[a]=d,streamPositions[a+1]=planePositions[3*n+1],streamPositions[a+2]=x;const m=.25+(rOuter-.25)*Math[o(330)](),_=Math[o(330)]()*Math.PI*2;streamPositions[a]=Math[o(453)](_)*m,streamPositions[a+1]=planeYCenter,streamPositions[a+2]=Math[o(360)](_)*m,curRadiusArr[e]=m,spiralPhase[e]=_,streamState[e]=STATE_ON_DISK,startTimes[e]=t-Math.random()*(rOuter-.25)/.9,ascendStart[e]=10*Math.random(),streamRiseDuration[e]=8+4*Math[o(330)]();const p=.5+1.5*Math[o(330)](),h=Math[o(330)]()<.5?-1:1;extraRotArr[e]=2*p*Math.PI*h;const u=idxToTopIdx[s];-1!==u&&(topAlpha[u]=1,staticGeo[o(449)].alpha[o(426)]=!0),activeImages[o(410)](e)&&releaseImageToPool(e),activeTexts[o(410)](e)&&releaseTextToPool(e),streamAlpha[e]=1,streamGeo[o(449)][o(359)].needsUpdate=!0}const now0=0;for(let e=0;e<streamCount;e++)initializeStreamParticleState(e,0);streamGeo[_0x3d2e67(449)][_0x3d2e67(516)][_0x3d2e67(426)]=!0,streamGeo[_0x3d2e67(449)][_0x3d2e67(359)].needsUpdate=!0;const clock=new _0x87c664.Clock;let initialColorApplied=!1;function mainAnimationLoop(){const e=_0x3d2e67;requestAnimationFrame(mainAnimationLoop);let t=clock.getDelta();const o=clock.getElapsedTime();t>.1&&(t=.1);for(let l=0;l<PLANE_COUNT;l++){const d=3*l;let x=planePositions[d],m=planePositions[d+2],_=Math[e(525)](x,m);if(_>.25){_=Math[e(511)](.25,_-.9*t);const p=Math.atan2(m,x);planePositions[d]=Math[e(453)](p)*_,planePositions[d+2]=Math[e(360)](p)*_}}if(planeGeo[e(449)][e(516)][e(426)]=!0,planeLayer[e(434)]&&(planeLayer[e(434)]=!0),planeLayer[e(461)].y=BASE_OMEGA*o,void 0!==ribbon&&(ribbon.rotation.y=planeLayer.rotation.y+RING_FLIP_Y),void 0!==ribbon&&ribbon[e(382)].length){const h=RING_START_RADIUS-.25;ribbon.children[e(311)](((o,a)=>{const s=e;o.userData[s(352)]-=.9*t,o[s(342)].radius-1.75<.25&&(o.userData[s(352)]+=h+2);const n=o[s(342)][s(352)]-1.75;if(n<1.25){const e=_0x87c664.MathUtils[s(549)]((n-.25)/1,0,1);o[s(479)].opacity=e}n<.25&&(o[s(342)][s(352)]+=h+2,o[s(479)][s(380)]=0),o[s(479)].opacity<1&&(o[s(479)][s(380)]=Math[s(339)](1,o.material[s(380)]+2*t));const r=o[s(342)].radius/RING_START_RADIUS;o[s(328)].set(r,3.5,r),o[s(479)].color[s(320)](16777215),o[s(461)].y=o[s(342)][s(396)]}))}camera.updateMatrixWorld();const a=camera[e(538)];if(cosmicDust[e(461)].y+=15e-5,streamHeartStarted){streamHeart[e(517)],new _0x87c664.Vector3,new(_0x87c664[e(357)]);const u=1e3*o;controlImageSpawningLogic(u),handleQueuedImageSpawns(),animateFloatingImageSprites(u),u-lastStatusLogTime>3e3&&(printImageSystemReport(),lastStatusLogTime=u);for(let A=0;A<streamCount;A++){const I=3*A,S=startTimes[A],f=o-(S+A%5*1.6),T=targetIdxArr[A];if(streamState[A]===STATE_ON_DISK){const P=spiralPhase[A]+BASE_OMEGA*(o-startTimes[A]);streamPositions[I]=Math.cos(P)*curRadiusArr[A],streamPositions[I+1]=planeYCenter,streamPositions[I+2]=Math.sin(P)*curRadiusArr[A],activeImages[e(410)](A)&&releaseImageToPool(A),streamAlpha[A]=1,f>=ascendStart[A]&&(streamState[A]=STATE_ASCEND,startTimes[A]=o,initialRadius[A]=curRadiusArr[A]);continue}if(f<-1.5){const C=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[e(453)](C),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math.sin(C),streamAlpha[A]=0;continue}if(f<0){const w=(f+1.5)/1.5,b=w*w*(3-2*w);streamAlpha[A]=b,activeImages[e(410)](A)&&releaseImageToPool(A);const E=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[e(453)](E),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math.sin(E);continue}const M=streamRiseDuration[A];if(f>=M){const y=(f-M)/1.5;if(y<1){const O=y*y*(3-2*y);if(streamAlpha[A]=1-O,activeImages[e(410)](A)){const G=activeImages.get(A);imagePool[G][e(479)][e(380)]*=1-O}const v=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[e(453)](v),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math[e(360)](v);continue}streamAlpha[A]=1,activeImages.has(A)&&releaseImageToPool(A),initializeStreamParticleState(A,o),firstResetCompleted||(firstResetCompleted=!0);continue}streamAlpha[A]=1;const g=f/M;if(g<.01){let R,H,N;const D=spiralPhase[A]+BASE_OMEGA*(o-S);{const F=initialRadius[A];R=Math[e(453)](D)*F,N=Math[e(360)](D)*F;const L=Math.min(1,g/.01);H=_0x87c664.MathUtils[e(507)](planeYCenter,apexY,L)}streamPositions[I]=R,streamPositions[I+1]=H,streamPositions[I+2]=N}else{const B=(g-.01)/.99,z=1-Math[e(370)](1-B,3),U=spiralPhase[A]+BASE_OMEGA*(o-S),Y=initialRadius[A],k=Math.cos(U)*Y,W=Math[e(360)](U)*Y,j=apexY,V=3*T,X=positions[V],Z=positions[V+1]-4+2,K=positions[V+2];let Q=_0x87c664[e(395)][e(507)](k,X,z),q=_0x87c664.MathUtils[e(507)](j,Z,z),J=_0x87c664[e(395)].lerp(W,K,z);const $=1+.1*(1-z);Q*=$,J*=$;const ee=(1-z)*extraRotArr[A],te=Math[e(453)](ee),oe=Math[e(360)](ee),ae=Q*te-J*oe,se=Q*oe+J*te;streamPositions[I]=ae,streamPositions[I+1]=q,streamPositions[I+2]=se}if(g<.01)streamAlpha[A]=1,activeImages[e(410)](A)&&releaseImageToPool(A);else{const ne=(g-.01)/.99;let re=null;if(activeImages[e(410)](A)){const ie=activeImages.get(A);re=imagePool[ie]}if(re){streamAlpha[A]=0,re[e(434)]=!0;const ce=1-Math.pow(1-ne,3),le=3*T,de=positions[le],xe=positions[le+1]-4+2,me=positions[le+2],_e=1+A%5*.2,pe=A%2==0?1:-1,he=spiralPhase[A]+ce*_e*Math.PI*2*pe,ue=(1-ce)*(2+1*Math[e(360)](A)),Ae=_0x87c664[e(395)].lerp(0,de,ce),Ie=_0x87c664[e(395)][e(507)](apexY,xe,ce),Se=_0x87c664[e(395)].lerp(0,me,ce),fe=Ae+Math[e(453)](he)*ue,Te=Ie,Me=Se+Math[e(360)](he)*ue;if(re[e(516)][e(320)](fe,Te,Me),ce>.4){const ge=(ce-.4)/.6,Pe=1;re.material[e(380)]=Pe*(1-ge);const Ce=1-.9*ge,we=re.userData[e(501)]||{x:IMAGE_CONFIG.scale,y:IMAGE_CONFIG[e(328)]};re[e(328)][e(320)](we.x*Ce,we.y*Ce,1),ge>.9&&(re[e(434)]=!1,releaseImageToPool(A))}else{re.material[e(380)]=1;const be=re[e(342)].aspectScale||{x:IMAGE_CONFIG[e(328)],y:IMAGE_CONFIG.scale};re.scale[e(320)](be.x,be.y,1)}}else streamAlpha[A]=1}if(streamGeo[e(449)][e(424)][e(426)]=!0,g>.95){const Ee=topIndices.indexOf(T);if(topPointVisibility[Ee]&&hiddenTopCount<MAX_TOP_HIDE){topPointVisibility[Ee]=!1;const ye=idxToTopIdx[T];-1!==ye&&(topAlpha[ye]=0,staticGeo[e(449)][e(359)][e(426)]=!0),hiddenTopCount++}}}}else{for(let Oe=0;Oe<streamCount;Oe++){if(streamHeartActiveRatio<1&&Oe/streamCount>.1){const Re=3*Oe,He=spiralPhase[Oe]+BASE_OMEGA*o;streamPositions[Re]=Math[e(453)](He)*curRadiusArr[Oe],streamPositions[Re+1]=planeYCenter,streamPositions[Re+2]=Math.sin(He)*curRadiusArr[Oe],streamAlpha[Oe]=0;continue}if(!firstResetCompleted&&Oe/streamCount>1e-4){const Ne=3*Oe,De=spiralPhase[Oe]+BASE_OMEGA*o;streamPositions[Ne]=Math[e(453)](De)*curRadiusArr[Oe],streamPositions[Ne+1]=planeYCenter,streamPositions[Ne+2]=Math.sin(De)*curRadiusArr[Oe],streamAlpha[Oe]=0;continue}const ve=3*Oe,Ge=spiralPhase[Oe]+BASE_OMEGA*o;streamPositions[ve]=Math.cos(Ge)*curRadiusArr[Oe],streamPositions[ve+1]=planeYCenter,streamPositions[ve+2]=Math[e(360)](Ge)*curRadiusArr[Oe],streamAlpha[Oe]=0}streamGeo[e(449)].position[e(426)]=!0,streamGeo[e(449)].alpha.needsUpdate=!0}streamGeo[e(449)][e(516)][e(426)]=!0,streamGeo[e(449)][e(359)].needsUpdate=!0;for(let Fe=0;Fe<vortexCount;Fe++){const Le=3*Fe,Be=1*Math.PI/10,ze=vortexRadius[Fe],Ue=o*Be,Ye=.3*Math[e(360)](Ue+vortexPhase[Fe]),ke=.2*Math[e(453)](.7*Ue+vortexPhase[Fe]),We=Ue+vortexPhase[Fe]+Ye,je=ze*(1+ke);vortexPositions[Le]=Math[e(453)](We)*je,vortexPositions[Le+1]=planeYCenter+.5*Math.sin(Ue+vortexPhase[Fe]),vortexPositions[Le+2]=Math.sin(We)*je}vortexGeo[e(449)].position[e(426)]=!0;const s=bottomGeo[e(449)][e(516)][e(429)];for(let Ve=0;Ve<bottomCount;Ve++){if(o<bottomDelayArr[Ve])continue;const Xe=bottomPhaseArr[Ve],Ze=bottomRadiusArr[Ve],Ke=Math[e(453)](Xe)*Ze;if(Math.abs(Xe)<.25*Math.PI){const et=Math[e(339)](1,Math[e(533)](Ke)/(.25*heartWidth)),tt=1.5*Math.pow(1-et,3)+1,ot=Ke>=0?1:-1;s[3*Ve]=Ke+ot*(Math.abs(Ke)*(tt-1))}else s[3*Ve]=Ke;s[3*Ve+2]=Math[e(360)](Xe)*Ze;const Qe=s[3*Ve],qe=s[3*Ve+1],Je=s[3*Ve+2],$e=new(_0x87c664[e(357)])(Qe,qe,Je)[e(411)](bottomHeart[e(517)]);(new _0x87c664.Vector3).copy($e)[e(411)](a),bottomAlphaArr[Ve]=bottomAlphaBase[Ve]}bottomGeo[e(449)].position.needsUpdate=!0,bottomGeo[e(449)].alpha.needsUpdate=!0;const n=controls[e(403)]();if(staticHeart&&(staticHeart[e(461)].y=n),bottomHeart&&(bottomHeart[e(461)].y=n),staticBottomHeart&&(staticBottomHeart[e(461)].y=n),staticTopHeart&&(staticTopHeart[e(461)].y=n),heartbeatEnabled){const at=1+.05*Math[e(360)](.5*o*Math.PI*2);staticHeart&&staticHeart[e(328)].set(at,at,at),bottomHeart&&bottomHeart[e(328)][e(320)](at,at,at),staticBottomHeart&&staticBottomHeart.scale[e(320)](at,at,at),staticTopHeart&&staticTopHeart[e(328)][e(320)](at,at,at)}if(controls[e(365)](),renderer[e(524)](),composerHeart[e(500)](),renderer.clearDepth(),renderer[e(540)]=!1,composerMain[e(500)](),renderer.autoClear=!0,hiddenTopCount<MAX_TOP_HIDE){for(let st=0;st<5&&hiddenTopCount<MAX_TOP_HIDE;st++){const nt=Math.floor(Math[e(330)]()*topIndices[e(392)]),rt=topIndices[nt];if(topPointVisibility[nt]){topPointVisibility[nt]=!1;const it=idxToTopIdx[rt];-1!==it&&(topAlpha[it]=0,hiddenTopCount++)}}staticGeo[e(449)][e(516)].needsUpdate=!0,staticGeo[e(449)][e(359)].needsUpdate=!0}for(let ct=explosionEffects[e(392)]-1;ct>=0;ct--){const lt=explosionEffects[ct];if(lt.userData.life-=t,lt[e(342)][e(486)]<=0)!isPulsing&&(isPulsing=!0,pulseStartTime=o,triggerCosmicRipple()),scene[e(504)](lt),explosionEffects[e(450)](ct,1);else{const dt=lt[e(382)][0],xt=dt[e(349)][e(449)][e(516)][e(429)],mt=lt[e(342)].velocities,_t=.04;for(let pt=0;pt<mt[e(392)];pt++){const ht=3*pt,ut=new(_0x87c664[e(357)])(xt[ht],xt[ht+1],xt[ht+2]),At=mt[pt],It=HEART_CENTER_TARGET.clone().sub(ut);At[e(507)](It,_t),xt[ht]+=At.x*t,xt[ht+1]+=At.y*t,xt[ht+2]+=At.z*t}dt.geometry[e(449)].position[e(426)]=!0,lt[e(342)].life<1&&(dt[e(479)].opacity=lt.userData[e(486)]/1)}}if(effectPool[e(546)][e(311)]((t=>{const a=e;if(!t[a(342)][a(514)])return;const s=(o-t[a(342)].creationTime)/1.8;s>=1?(t[a(342)][a(514)]=!1,t.visible=!1):(t[a(535)](camera[a(516)]),t[a(328)][a(320)](1+6*s,1+6*s,1),t[a(479)].opacity=.6*(1-s))})),effectPool.sparkles[e(311)]((a=>{const s=e;if(!a[s(342)].active)return;const n=(o-a[s(342)][s(480)])/1.8;if(n>=1)a[s(342)][s(514)]=!1,a.visible=!1;else{const e=a[s(349)][s(449)][s(516)][s(429)],o=a[s(342)].velocities;for(let a=0;a<100;a++){const s=3*a;e[s]+=o[s]*t,e[s+1]+=o[s+1]*t}a[s(349)][s(449)][s(516)][s(426)]=!0,a.material[s(380)]=1-Math[s(370)](n,2)}})),streamHeartStarted&&allWordsFlat[e(392)]>0&&o>nextWordSpawnTime){const St=allWordsFlat[currentWordIndex];let ft=-1;for(let Tt=0;Tt<streamCount;Tt++){const Mt=(o-startTimes[Tt])/streamRiseDuration[Tt];if(streamState[Tt]===STATE_ASCEND&&Mt>0&&Mt<.1&&!activeImages.has(Tt)&&!activeTexts[e(410)](Tt)){ft=Tt;break}}if(-1!==ft){const gt=effectPool[e(315)][e(573)]((t=>!t[e(342)].active&&t[e(342)][e(542)]===St));gt&&(gt[e(342)].active=!0,gt[e(342)][e(499)]=o,gt[e(434)]=!0,gt[e(479)].opacity=0,activeTexts.set(ft,gt),currentWordIndex=(currentWordIndex+1)%allWordsFlat[e(392)],nextWordSpawnTime=o+.4)}}activeTexts[e(311)](((t,a)=>{const s=e,n=streamPositions[3*a],r=streamPositions[3*a+1],i=streamPositions[3*a+2];t[s(516)][s(320)](n,r+1.5,i);const c=o-t[s(342)].spawnTime,l=(o-startTimes[a])/streamRiseDuration[a];t[s(479)][s(380)]=c<.8?c/.8:l>.7?Math[s(511)](0,1-(l-.7)/.3):1,(streamState[a]===STATE_ON_DISK||l>=1)&&releaseTextToPool(a)})),activeTexts[e(311)](((t,a)=>{const s=e,n=streamPositions[3*a],r=streamPositions[3*a+1],i=streamPositions[3*a+2];t[s(516)][s(320)](n,r+1.5,i);const c=o-t.userData[s(499)],l=(o-startTimes[a])/streamRiseDuration[a];t[s(479)][s(380)]=c<1?c/1:l>.7?Math[s(511)](0,1-(l-.7)/.3):1,streamState[a]===STATE_ON_DISK&&releaseTextToPool(a)}));const r=[staticHeart,bottomHeart,staticBottomHeart,staticTopHeart];let i=new(_0x87c664[e(306)]);if(useCustomColor?i.copy(heartInitialColor):i[e(456)](.05*o%1,.8,.6),isPulsing){const Pt=Math[e(339)]((o-pulseStartTime)/.6,1),Ct=Math[e(360)](Pt*Math.PI),wt=1+.15*Ct;r[e(311)]((t=>{t&&t[e(328)].set(wt,wt,wt)}));const bt=new _0x87c664.Color(16777215);i.lerp(bt,.8*Ct),Pt>=1&&(isPulsing=!1,r[e(311)]((t=>{const o=e;t&&t[o(328)][o(320)](1,1,1)})))}if(!useCustomColor||isPulsing||!initialColorApplied){const Et=i.r,yt=i.g,Ot=i.b;function c(e){if(e)for(let t=0;t<e.length;t+=3)e[t]=Et,e[t+1]=yt,e[t+2]=Ot}c(planeGeo[e(449)].color[e(429)]),c(staticGeo[e(449)][e(378)][e(429)]),c(bottomGeo[e(449)][e(378)][e(429)]),staticBottomHeart&&c(staticBottomHeart.geometry.attributes[e(378)][e(429)]),staticTopHeart&&c(staticTopHeart[e(349)][e(449)][e(378)].array),c(vortexGeo.attributes.color[e(429)]),c(streamGeo[e(449)][e(378)].array),planeGeo[e(449)][e(378)].needsUpdate=!0,staticGeo[e(449)][e(378)][e(426)]=!0,bottomGeo.attributes.color[e(426)]=!0,staticBottomHeart&&(staticBottomHeart[e(349)][e(449)][e(378)][e(426)]=!0),staticTopHeart&&(staticTopHeart[e(349)].attributes[e(378)].needsUpdate=!0),vortexGeo.attributes[e(378)].needsUpdate=!0,streamGeo[e(449)][e(378)][e(426)]=!0,ribbon[e(382)].forEach((t=>{const o=e;t[o(479)][o(378)][o(428)](Et,yt,Ot)})),initialColorApplied=!0}if(o>=nextShootTime){for(let vt=0;vt<SHOOT_MAX;vt++)if(shootLife[vt]<=0){const Gt=3*vt,Rt=200,Ht=new(_0x87c664[e(357)])(2*(Math.random()-.5),2*(Math[e(330)]()-.5),2*(Math[e(330)]()-.5))[e(423)]()[e(503)](Rt);shootPositions[Gt]=Ht.x,shootPositions[Gt+1]=Ht.y,shootPositions[Gt+2]=Ht.z;const Nt=new(_0x87c664[e(357)])(Math.random()-.5,Math[e(330)]()-.5,Math[e(330)]()-.5).normalize(),Dt=(new _0x87c664.Vector3).crossVectors(Ht,Nt)[e(423)](),Ft=40+30*Math[e(330)]();shootVel[Gt]=Dt.x*Ft,shootVel[Gt+1]=Dt.y*Ft,shootVel[Gt+2]=Dt.z*Ft,shootBirth[vt]=o,shootLife[vt]=(SHOOT_OUT_RADIUS-Rt)/Ft,shootAlpha[vt]=.8+.2*Math[e(330)]();break}nextShootTime=o+.5+Math.random()}for(let Lt=0;Lt<SHOOT_MAX;Lt++)if(shootLife[Lt]>0){const Bt=3*Lt;shootPositions[Bt]+=shootVel[Bt]*t,shootPositions[Bt+1]+=shootVel[Bt+1]*t,shootPositions[Bt+2]+=shootVel[Bt+2]*t;const zt=Math[e(525)](shootPositions[Bt],shootPositions[Bt+1],shootPositions[Bt+2]);if(shootBirth[Lt],shootLife[Lt],zt>SHOOT_OUT_RADIUS)shootLife[Lt]=0,shootAlpha[Lt]=0;else{const kt=.9,Wt=zt/SHOOT_OUT_RADIUS;shootAlpha[Lt]=Wt>kt?1-(Wt-kt)/(1-kt):1}const Ut=Lt*(TAIL_SEGMENTS+1),Yt=3*Ut;tailPositions[Yt]=shootPositions[Bt],tailPositions[Yt+1]=shootPositions[Bt+1],tailPositions[Yt+2]=shootPositions[Bt+2],tailAlphas[Ut]=shootAlpha[Lt];for(let jt=1;jt<=TAIL_SEGMENTS;jt++){const Vt=Lt*(TAIL_SEGMENTS+1)+jt,Xt=3*Vt;tailPositions[Xt]=shootPositions[Bt]-shootVel[Bt]*jt*TAIL_SPACING,tailPositions[Xt+1]=shootPositions[Bt+1]-shootVel[Bt+1]*jt*TAIL_SPACING,tailPositions[Xt+2]=shootPositions[Bt+2]-shootVel[Bt+2]*jt*TAIL_SPACING;const Zt=1-jt/TAIL_SEGMENTS;tailAlphas[Vt]=shootAlpha[Lt]*Zt}}if(tailGeo[e(449)][e(516)].needsUpdate=!0,tailGeo[e(449)][e(359)][e(426)]=!0,heartbeatEnabled){const Kt=1+.05*Math[e(360)](.5*o*Math.PI*2);staticHeart&&staticHeart.scale.set(Kt,Kt,Kt),bottomHeart&&bottomHeart.scale[e(320)](Kt,Kt,Kt),staticBottomHeart&&staticBottomHeart.scale[e(320)](Kt,Kt,Kt),staticTopHeart&&staticTopHeart[e(328)].set(Kt,Kt,Kt)}if(null!==revealStart&&(fadeObjects[e(311)]((t=>{const a=e;if(!t||t===ribbon)return;const s=t[a(342)][a(552)]??0,n=_0x87c664[a(395)][a(549)]((o-revealStart-.15*s)/.15,0,1),r=n*n*(3-2*n);t[a(414)]?.((e=>{const t=a,o=e.material;if(!o)return;if(e[t(485)]&&e[t(342)].text&&!1===e[t(342)].active)return void(o.opacity=0);const s=e.userData[t(343)]??1;o[t(380)]=s*r})),s===STAGE[a(391)]&&r>.1&&(streamHeartStarted=!0,streamHeartActiveRatio=r)})),o-revealStart>.15*(STAGE[e(484)]+1)&&(revealStart=null)),null!==cameraAnimationStart){const Qt=o-cameraAnimationStart,qt=_0x87c664.MathUtils[e(549)](Qt/2.5,0,1),Jt=qt*qt*(3-2*qt);camera.position.x=_0x87c664[e(395)][e(507)](CAMERA_START_POSITION.x,CAMERA_END_POSITION.x,Jt),camera.position.y=_0x87c664.MathUtils[e(507)](CAMERA_START_POSITION.y,CAMERA_END_POSITION.y,Jt),camera[e(516)].z=_0x87c664[e(395)][e(507)](CAMERA_START_POSITION.z,CAMERA_END_POSITION.z,Jt),camera.lookAt(0,0,0),qt>=1&&(cameraAnimationStart=null,camera.position[e(320)](CAMERA_END_POSITION.x,CAMERA_END_POSITION.y,CAMERA_END_POSITION.z),camera[e(535)](0,0,0))}}function triggerCosmicRipple(){const e=_0x3d2e67,t=(new(_0x87c664[e(306)]))[e(456)](.05*clock.getElapsedTime()%1,.9,.7),o=effectPool[e(546)][e(573)]((t=>!t.userData[e(514)]));o&&(o[e(342)][e(514)]=!0,o[e(434)]=!0,o[e(342)][e(480)]=clock[e(458)](),o[e(516)][e(366)](HEART_CENTER_TARGET),o[e(461)].z=Math.PI,o[e(328)].set(1,1,1),o.material.color.copy(t));const a=effectPool.sparkles.find((t=>!t[e(342)][e(514)]));if(a){a.userData[e(514)]=!0,a[e(434)]=!0,a[e(342)][e(480)]=clock.getElapsedTime(),a[e(516)][e(366)](HEART_CENTER_TARGET),a[e(461)].z=Math.PI,a[e(479)][e(378)][e(366)](t);const o=a.geometry[e(449)][e(516)][e(429)];for(let t=0;t<100;t++){const s=Math[e(330)]()*Math.PI*2,n=9,r=20*Math.random()+20,i=3*t;o[i]=Math[e(453)](s)*n,o[i+1]=Math[e(360)](s)*n,o[i+2]=5*(Math.random()-.5),a[e(342)].velocities||(a[e(342)][e(383)]=[]),a[e(342)][e(383)][i]=Math[e(453)](s)*r,a[e(342)][e(383)][i+1]=Math[e(360)](s)*r,a[e(342)][e(383)][i+2]=5*(Math[e(330)]()-.5)}a[e(349)][e(449)].position[e(426)]=!0}}setupEffectPools(),window[_0x3d2e67(475)](_0x3d2e67(374),(()=>{const e=_0x3d2e67;camera.aspect=window[e(568)]/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window[e(568)],window[e(554)])}));const refinedBottomPos=[],refinedBottomColors=[],refinedBottomSizes=[];for(let e=0;e<bottomPositions[_0x3d2e67(392)];e+=3){const t=bottomPositions[e],o=bottomPositions[e+1],a=bottomPositions[e+2];(calculateMinimumDistanceToBorder(t,o)<BORDER_THRESHOLD||Math[_0x3d2e67(330)]()<.9)&&(refinedBottomPos[_0x3d2e67(408)](t,o,a),refinedBottomColors.push(heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),refinedBottomSizes.push(bottomSizes[e/3]))}bottomPositions=refinedBottomPos,bottomColors[_0x3d2e67(392)]=0,bottomColors.push(...refinedBottomColors),bottomSizes[_0x3d2e67(392)]=0,bottomSizes[_0x3d2e67(408)](...refinedBottomSizes);const starLayers=[];function createStarLayer({count:e,radius:t,colors:o,minSize:a,maxSize:s,opacity:n=1.2}){const r=_0x3d2e67,i=new Float32Array(3*e),c=new Float32Array(3*e),l=new Float32Array(e),d=new Float32Array(e),x=new Float32Array(e),m=new Float32Array(e);for(let n=0;n<e;n++){const e=3*n,_=Math[r(397)](2*Math[r(330)]()-1),p=Math[r(330)]()*Math.PI*2;i[e]=t*Math.cos(p)*Math.sin(_),i[e+1]=t*Math[r(360)](p)*Math.sin(_),i[e+2]=t*Math[r(453)](_);const h=o[Math.floor(Math[r(330)]()*o[r(392)])];c[e]=h.r,c[e+1]=h.g,c[e+2]=h.b,l[n]=Math.random()*(s-a)+a,d[n]=1,x[n]=Math[r(330)]()*Math.PI*2,m[n]=.5+1.5*Math[r(330)]()}const _=new(_0x87c664[r(508)]);_[r(326)]("position",new(_0x87c664[r(472)])(i,3)),_[r(326)](r(378),new(_0x87c664[r(472)])(c,3)),_.setAttribute(r(424),new(_0x87c664[r(472)])(l,1)),_[r(326)]("alpha",new(_0x87c664[r(472)])(d,1).setUsage(_0x87c664[r(547)])),_.userData[r(396)]=x,_[r(342)][r(418)]=m;const p=makeMat({map:circleTexture,blending:_0x87c664.AdditiveBlending,depthWrite:!1,alphaSupport:!0,opacity:n,sizeAttenuation:!1,vertexColors:!0});return p[r(436)]=function(e){const t=r;e[t(572)]=e[t(572)][t(506)](t(381),t(441)),e[t(572)]=e[t(572)][t(506)](t(505),t(323)),e[t(435)]=e[t(435)][t(506)](t(348),"varying float vAlpha;\nvoid main(){"),e[t(435)]=e[t(435)].replace(t(465),t(427))},new(_0x87c664[r(401)])(_,p)}const starColors=[new(_0x87c664[_0x3d2e67(306)])(16777215),new(_0x87c664[_0x3d2e67(306)])(11197695),new(_0x87c664[_0x3d2e67(306)])(16777184),new(_0x87c664[_0x3d2e67(306)])(16767153)],farStars=createStarLayer({count:6e3,radius:250,colors:[new(_0x87c664[_0x3d2e67(306)])(11197695),new(_0x87c664[_0x3d2e67(306)])(16777215)],minSize:.5,maxSize:1.5,opacity:.8}),midStars=createStarLayer({count:3e3,radius:180,colors:starColors,minSize:1,maxSize:2.5,opacity:1}),nearStars=createStarLayer({count:1e3,radius:120,colors:starColors,minSize:1.5,maxSize:4,opacity:1.2});starLayers.push(farStars,midStars,nearStars),starLayers.forEach((e=>{const t=_0x3d2e67;scene[t(513)](e),e[t(434)]=!1,fadeObjects[t(408)](e),e[t(342)][t(552)]=STAGE[t(386)]}));const dustParticlesCount=50,dustPositions=new Float32Array(150),dustColors=new Float32Array(150),dustColor=new(_0x87c664[_0x3d2e67(306)])(16777215);for(let e=0;e<50;e++){const t=3*e,o=Math[_0x3d2e67(397)](2*Math[_0x3d2e67(330)]()-1),a=Math[_0x3d2e67(330)]()*Math.PI*2,s=200*Math[_0x3d2e67(330)]()+50;dustPositions[t]=s*Math[_0x3d2e67(453)](a)*Math[_0x3d2e67(360)](o),dustPositions[t+1]=s*Math[_0x3d2e67(360)](a)*Math[_0x3d2e67(360)](o),dustPositions[t+2]=s*Math[_0x3d2e67(453)](o);const n=.5*Math[_0x3d2e67(330)]()+.5;dustColors[t]=dustColor.r*n,dustColors[t+1]=dustColor.g*n,dustColors[t+2]=dustColor.b*n}const dustGeometry=new(_0x87c664[_0x3d2e67(508)]);dustGeometry.setAttribute("position",new(_0x87c664[_0x3d2e67(472)])(dustPositions,3)),dustGeometry[_0x3d2e67(326)](_0x3d2e67(378),new(_0x87c664[_0x3d2e67(472)])(dustColors,3));const dustMaterial=new _0x87c664.PointsMaterial({size:.2,vertexColors:!0,blending:_0x87c664.AdditiveBlending,transparent:!0,opacity:.7}),cosmicDust=new(_0x87c664[_0x3d2e67(401)])(dustGeometry,dustMaterial);scene[_0x3d2e67(513)](cosmicDust),STAR_COUNT=0,starAlpha=null,starPhase=null,starGeo=null;const SHOOT_MAX=10,TAIL_SEGMENTS=260,TAIL_SPACING=.001,SHOOT_OUT_RADIUS=350,SHOOT_POINTS=SHOOT_MAX*(1+TAIL_SEGMENTS),shootPositions=new Float32Array(3*SHOOT_MAX),shootVel=new Float32Array(3*SHOOT_MAX),shootBirth=new Float32Array(SHOOT_MAX),shootLife=new Float32Array(SHOOT_MAX)[_0x3d2e67(432)](0),shootAlpha=new Float32Array(SHOOT_MAX)[_0x3d2e67(432)](0),shootSize=new Float32Array(SHOOT_MAX);for(let e=0;e<SHOOT_MAX;e++)shootSize[e]=3;const tailPositions=new Float32Array(3*SHOOT_POINTS),tailColors=new Float32Array(3*SHOOT_POINTS),tailSizes=new Float32Array(SHOOT_POINTS),tailAlphas=new Float32Array(SHOOT_POINTS)[_0x3d2e67(432)](0);for(let e=0;e<SHOOT_MAX;e++){tailSizes[e*(TAIL_SEGMENTS+1)]=6;for(let t=1;t<=TAIL_SEGMENTS;t++){const o=e*(TAIL_SEGMENTS+1)+t,a=1-t/TAIL_SEGMENTS;tailSizes[o]=4*a;const s=3*o;tailColors[s]=.7*a,tailColors[s+1]=.8*a,tailColors[s+2]=1*a}}for(let e=0;e<SHOOT_MAX;e++){const t=e*(TAIL_SEGMENTS+1)*3;tailColors[t]=1,tailColors[t+1]=1,tailColors[t+2]=1}const tailGeo=new(_0x87c664[_0x3d2e67(508)]);tailGeo.setAttribute("position",new(_0x87c664[_0x3d2e67(472)])(tailPositions,3)[_0x3d2e67(363)](_0x87c664[_0x3d2e67(547)])),tailGeo[_0x3d2e67(326)]("color",new(_0x87c664[_0x3d2e67(472)])(tailColors,3)),tailGeo[_0x3d2e67(326)](_0x3d2e67(424),new _0x87c664.BufferAttribute(tailSizes,1)),tailGeo[_0x3d2e67(326)](_0x3d2e67(359),new(_0x87c664[_0x3d2e67(472)])(tailAlphas,1)[_0x3d2e67(363)](_0x87c664[_0x3d2e67(547)]));const tailMat=makeMat({map:circleTexture,blending:_0x87c664[_0x3d2e67(337)],depthWrite:!1,alphaSupport:!0,vertexColors:!0,opacity:2,sizeAttenuation:!1});tailMat[_0x3d2e67(436)]=function(e){const t=_0x3d2e67;e[t(572)]=e[t(572)][t(506)](t(381),t(441)),e.vertexShader=e[t(572)].replace("#include <project_vertex>",t(323)),e[t(435)]=e.fragmentShader[t(506)](t(348),"varying float vAlpha;\nvoid main(){"),e.fragmentShader=e[t(435)][t(506)](t(465),t(427))};const shootingStars=new(_0x87c664[_0x3d2e67(401)])(tailGeo,tailMat);scene[_0x3d2e67(513)](shootingStars),shootingStars[_0x3d2e67(342)][_0x3d2e67(552)]=STAGE[_0x3d2e67(493)];let nextShootTime=0;function triggerSceneActivation(e){const t=_0x3d2e67;heartbeatEnabled||(heartbeatEnabled=!0,setupImageObjectPool(),lastImageSpawnTime=0,imageSpawnQueue.length=0,currentImageIndex=0,lastStatusLogTime=0,nextIndependentSpawnTime=0,independentImageSprites.forEach((e=>{const t=_0x48ee;e&&e[t(420)]&&e[t(420)][t(504)](e)})),independentImageSprites.length=0,fadeObjects.forEach((e=>{const t=_0x48ee;e&&(e.visible=!0,e[t(414)]?.((e=>{const o=t,a=e[o(479)];a&&(e[o(479)]&&void 0===e[o(342)][o(343)]&&(e.userData.baseOpacity=e[o(479)][o(380)]??1),a[o(380)]=0)})))})),revealStart=clock.getElapsedTime(),cameraAnimationStart=clock[t(458)](),userHasMovedCamera&&(CAMERA_START_POSITION={x:camera[t(516)].x,y:camera[t(516)].y,z:camera[t(516)].z}))}fadeObjects.push(streamHeart,shootingStars),[streamHeart,shootingStars].forEach((e=>{const t=_0x3d2e67;e&&(e[t(434)]=!1,e[t(414)]?.((e=>{const o=t;e[o(479)]&&void 0===e.userData[o(343)]&&(e[o(342)][o(343)]=e[o(479)][o(380)]??1)})))})),renderer[_0x3d2e67(555)].addEventListener(_0x3d2e67(379),(e=>{createHeartExplosion(e)}));const offi=_0x3d2e67(376),current=window[_0x3d2e67(566)][_0x3d2e67(560)];current!==offi&&(document.body[_0x3d2e67(523)]="",warningText[_0x3d2e67(399)]=" ",warningDiv[_0x3d2e67(385)](warningText),document[_0x3d2e67(345)][_0x3d2e67(385)](warningDiv)),triggerSceneActivation();let lastTouchEnd=0;document[_0x3d2e67(475)](_0x3d2e67(515),(function(e){const t=_0x3d2e67,o=(new Date).getTime();o-lastTouchEnd<=300&&e[t(439)](),lastTouchEnd=o}),!1),document.addEventListener(_0x3d2e67(543),(function(e){e[_0x3d2e67(439)]()}),{passive:!1}),document[_0x3d2e67(475)](_0x3d2e67(521),(function(e){e[_0x3d2e67(439)]()}),{passive:!1}),document[_0x3d2e67(475)](_0x3d2e67(307),(function(e){e[_0x3d2e67(439)]()}),{passive:!1}),mainAnimationLoop(),scene[_0x3d2e67(513)](staticBottomHeart),[staticTopHeart][_0x3d2e67(311)]((e=>{const t=_0x3d2e67;e&&(e[t(434)]=!1,e[t(342)][t(552)]=STAGE[t(484)],fadeObjects.push(e))})),controls.addEventListener("change",(()=>{const e=_0x3d2e67;userHasMovedCamera||(CAMERA_START_POSITION={x:camera.position.x,y:camera[e(516)].y,z:camera.position.z},userHasMovedCamera=!0)}));const style=document[_0x3d2e67(433)](_0x3d2e67(329));style.innerHTML=_0x3d2e67(541),document[_0x3d2e67(437)].appendChild(style);